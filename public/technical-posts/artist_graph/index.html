<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Similar artist network | Colin Spear</title><meta name=keywords content><meta name=description content="Motivation If you are anything like me, you occasionally find yourself coming up for air after a long diversion clicking through artist biographies on Spotify. Often these biographies will list the artists other bands or people they have played with, and one thing leads to another and I have added twenty albums to my &ldquo;new music&rdquo; playlist folder.
I found myself in this position one morning after listening to this episode of Casual Inference, a great podcast that has unfortunately gone radio silent of late."><meta name=author content="Me"><link rel=canonical href=//www.colinspear.com/technical-posts/artist_graph/><link crossorigin=anonymous href=/assets/css/stylesheet.min.149ea7cdaa83f0ab31471ced9e0495af0272de908dd4a38e5c229d8b0579a758.css integrity="sha256-FJ6nzaqD8KsxRxztngSVrwJy3pCN1KOOXCKdiwV5p1g=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.27cd435cc9ed6abb4b496581b151804f79f366c412620272bb94e2f5f598ebcc.js integrity="sha256-J81DXMntartLSWWBsVGAT3nzZsQSYgJyu5Ti9fWY68w=" onload=hljs.initHighlightingOnLoad();></script><link rel=icon href=//www.colinspear.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=//www.colinspear.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=//www.colinspear.com/favicon-32x32.png><link rel=apple-touch-icon href=//www.colinspear.com/apple-touch-icon.png><link rel=mask-icon href=//www.colinspear.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.68.3"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme: rgb(29, 30, 32);--entry: rgb(46, 46, 51);--primary: rgb(218, 218, 219);--secondary: rgb(155, 156, 157);--tertiary: rgb(65, 66, 68);--content: rgb(196, 196, 197);--hljs-bg: rgb(46, 46, 51);--code-bg: rgb(55, 56, 62);--border: rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','G-BFJ2WK0V8F','auto');ga('send','pageview');}</script><meta property="og:title" content="Similar artist network"><meta property="og:description" content="Motivation If you are anything like me, you occasionally find yourself coming up for air after a long diversion clicking through artist biographies on Spotify. Often these biographies will list the artists other bands or people they have played with, and one thing leads to another and I have added twenty albums to my &ldquo;new music&rdquo; playlist folder.
I found myself in this position one morning after listening to this episode of Casual Inference, a great podcast that has unfortunately gone radio silent of late."><meta property="og:type" content="article"><meta property="og:url" content="//www.colinspear.com/technical-posts/artist_graph/"><meta property="article:section" content="technical-posts"><meta property="article:published_time" content="2023-08-29T00:00:00+00:00"><meta property="article:modified_time" content="2023-08-29T00:00:00+00:00"><meta property="og:site_name" content="Colin Spear"><meta name=twitter:card content="summary"><meta name=twitter:title content="Similar artist network"><meta name=twitter:description content="Motivation If you are anything like me, you occasionally find yourself coming up for air after a long diversion clicking through artist biographies on Spotify. Often these biographies will list the artists other bands or people they have played with, and one thing leads to another and I have added twenty albums to my &ldquo;new music&rdquo; playlist folder.
I found myself in this position one morning after listening to this episode of Casual Inference, a great podcast that has unfortunately gone radio silent of late."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":3,"name":"Similar artist network","item":"//www.colinspear.com/technical-posts/artist_graph/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Similar artist network","name":"Similar artist network","description":"Motivation If you are anything like me, you occasionally find yourself coming up for air after a long diversion clicking through artist biographies on Spotify. Often these biographies will list the artists other bands or people they have played with, and one thing leads to another and I have added twenty albums to my \u0026ldquo;new music\u0026rdquo; playlist folder.\nI found myself in this position one morning after listening to this episode of Casual Inference, a great podcast that has unfortunately gone radio silent of late.","keywords":[],"articleBody":"Motivation If you are anything like me, you occasionally find yourself coming up for air after a long diversion clicking through artist biographies on Spotify. Often these biographies will list the artists other bands or people they have played with, and one thing leads to another and I have added twenty albums to my “new music” playlist folder.\nI found myself in this position one morning after listening to this episode of Casual Inference, a great podcast that has unfortunately gone radio silent of late. The guest, Betsy Ogburn, is an expert in causality in social networks, a difficult (so. much. endogeneity.) and super interesting field. I had been reading one of her papers and so my brain was primed for thinking about networks. Could I use the Spotify API to create an artist network to investigate questions like:\n Does having a more popular artist guest on a track garner more listens? Does having a certain producer increase listens? Do super studio musicians have any effect on track plays?  I quickly discovered that this is unfortunately not one of the endpoints in the amazing Spotify API (go check it out if you never have)1. After inquiring about this absence, I realized that the “Related artists” are a natural way to build an artist network.\nPrior to this I had never done any network analysis with python, so I thought this could be an interesting way to interact with Spotify’s API in a new way and learn a little bit about what python tools are available for network analysis. This is my “what can I do in an hour” exploration of these ideas.\nCleanup  Disclaimer: This post is a quick and dirty analysis! My time was limited, so basically I constrained myself to seeing if I could figure out the relevant tooling and make a plot. I have left it messy so you can see my process getting from nothing to something at least marginally interesting.\n I am not including the code to pull the artist information from Spotify. If you are interested, the code for that is on github here. I saved it as json, so the first thing I do here is import the packages I will use in the analysis and massage the data into the shape I need to plot the network. Networkx seems to be the main python package for network analysis in python. I barely scratch the surface here.\nimport json import networkx as nx import pandas as pd import numpy as np # load artist data with open('../data/raw/followed_artists.json') as f: artists = json.load(f) Spotify includes a lot of metadata and other information that I am not interested in for this exercise, so the next cell makes a dictionary of only the data that is relevant for my purposes.\n# create a dictionary of the relevant information artists_dict = {} artists_dict['id'] = [i['id'] for i in artists] artists_dict['artist'] = [i['name'] for i in artists] artists_dict['followers'] = [i['followers']['total'] for i in artists] artists_dict['popularity'] = [i['popularity'] for i in artists] artists_dict['related_artist'] = [i['related_artists'] for i in artists] Pandas has a bunch of different methods for reading data into dataframes. .from_dict() will take a dicitonary as input and create a dataframe\ndf = pd.DataFrame.from_dict(artists_dict) Now we have a dataframe we can use with NetworkX. Unfortunately, the related_artist column is a list. I need to expand it so that each item in the list gets it’s own row along with all of the other data in that row. This was a trickier problem that I initially anticipated, but thankfully someone before me had the same problem and a stackoverflow samaritan came to their rescue.\n# \"melt\" name list into individual rows # https://stackoverflow.com/questions/27263805/pandas-column-of-lists-create-a-row-for-each-list-element lst_col = 'related_artist' r = pd.DataFrame({ col:np.repeat(df[col].values, df[lst_col].str.len()) for col in df.columns.drop(lst_col)} ).assign(**{lst_col:np.concatenate(df[lst_col].values)})[df.columns] Unfortunately, it turns out A$AP Rocky and Joey Bada$$ are too bada$$ for NetworkX.\nr.loc[r['related_artist'].str.contains('\\$')] .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; }  The $ is a special character and breaks the graphing algorithm. I will make them significantly less cool by replacing their $ with S.\n# temp fix to remove special characters from name (Joey Bada$$ and A$AP Rocky were throwing errors) r['artist'] = r['artist'].str.replace('$', 'S') r['related_artist'] = r['related_artist'].str.replace('$', 'S') r.loc[r['related_artist'].str.contains('\\$')] .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; }  There we go. On to the network graph!\nVisualization NetworkX provides a very user friendly out of the box graphing method that will allow you to get a sense of the basic structure of a graph. It is essentially just a wrapper around matplotlib, so you can use matplotlib’s extensive (and often arcane) customization if you need to make something pretty to show your bosses. For my current purposes, I just want to get a sense of the network structure, then go on to look at some of the statistical features of the network. Here goes.\nG = nx.from_pandas_edgelist(r, source='artist', target='related_artist', edge_attr='followers', create_using=nx.DiGraph()) nx.draw_networkx(G) Oof, that’s not very helpful. It looks like it could be a bit donut shaped? Let’s pare things down a bit. I’m just going to take a random sample and replot to see if that helps.\nr_graph = r.sample(100) G = nx.from_pandas_edgelist(r_graph, source='artist', target='related_artist', edge_attr='followers', create_using=nx.DiGraph()) nx.draw_networkx(G) There’s our donut! It’s definitely a small world graph with a few artists in the middle, connecting the disparate groups (makes sense that Arthur Russell and Bonnie Prince Billy would be the weirdos crossing over :).\nLet’s get rid of the names, make the nodes smaller and increase the sample size a bit.\nr_graph = r.sample(500) G = nx.from_pandas_edgelist(r_graph, source='artist', target='related_artist', edge_attr='followers', create_using=nx.DiGraph()) nx.draw_networkx(G, with_labels=False, node_size=10) Much better. Just lighten up the edges a touch and…\nnx.draw_networkx(G, with_labels=False, node_size=10, width=0.5) Voila!\nIs this a Small World Network? Visually, this looks like it could be a Small-world network, with a sort of halo of clusters around the edgo of the graph and a non-trivial number of paths from opposing edges. From the Wikipedia article:\n A small-world network is a type of mathematical graph in which most nodes are not neighbors of one another, but the neighbors of any given node are likely to be neighbors of each other and most nodes can be reached from every other node by a small number of hops or steps.\n To wrap up this blog post, I am going to calculate some statistics to see if this indeed is likely a Small-world network and have a look at the artists that most connect otherwise disparate parts of the graph.\nOne of the signature characteristics of this type of network is that the distance between randomly chosen nodes (in this case artists) is proportional to the logarithm of the total number of nodes in the network2.\nAccording to this post, the best way to do this is to calculate the mean shortest path length and clustering coefficients of your network and compare them to the equivalent statistics of a synthetic random network. So this is what we will do. But before we do that, let’s talk about what exactly those things are.\n Diversion on path length and clustering TODO: briefly explain clustering and path length\n Now, back to our analysis. Our procedure is the following:\n Calculate average path length and clustering coefficient of the original network. Generate the appropriate synthetic network. Repeat Step 1 for the synthetic network. Calculate small-world statistics. Prosper.  Why do we care about whether or not this is a small world network? The network we are examining is all of the related artists of the artists I follow on Spotify. What is this, exactly? According to the Spotify API docs, related artists are artists similar to a given artist and similarity is based on analysis of the Spotify community’s listening history. This article goes into a bit more detail, hinting that size of listenership and number of shared listeners are important parameters in the algorithm that decides shared listeners, but few details are provided. This means that at a high, hand-wavy level, the related artists I see for Benny Sings are just other artists whose listeners overlap in some significant way with Benny Sings’ listeners.\nSo what we have here is a listening network.\nQuestions:\n Who is connected to the most other artists? Who connects otherwise poorly connected regions? Do we have any natural clusters or communities? What do they have in common?    After doing some poking around, I noticed that they get most of their biographical information from Rovi, which also has a lot of other information. I can’t tell what their usage model it, but I would love to poke into it more at some point. ↩︎\n At first I thought I could do this by randomly sampling nodes from my artist network, but it’s not actually that simple. One interesting exercise that might get at this would be to choose an artist and build the connected graph step by step (i.e. record the original artist’s network, then include their network’s netowrks, and so on until you run out of artists or patience), calculating the distance between randomly chosen nodes and the log total nodes at each step. I think this would reasonably approximate the natural growth of a listening network and would certainly be better that just sampling nodes. ↩︎\n   ","wordCount":"1544","inLanguage":"en","datePublished":"2023-08-29T00:00:00Z","dateModified":"2023-08-29T00:00:00Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"//www.colinspear.com/technical-posts/artist_graph/"},"publisher":{"@type":"Organization","name":"Colin Spear","logo":{"@type":"ImageObject","url":"//www.colinspear.com/favicon.ico"}}}</script></head><body id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><header class=header><nav class=nav><div class=logo><a href=//www.colinspear.com accesskey=h title="Colin Spear (Alt + H)">Colin Spear</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=//www.colinspear.com/links/ title=Links><span>Links</span></a></li><li><a href=//www.colinspear.com/thoughts-posts/ title=Notes><span>Notes</span></a></li><li><a href=//www.colinspear.com/technical-posts/ title=Technical><span>Technical</span></a></li><li><a href=//www.colinspear.com/books/ title=Books><span>Books</span></a></li><li><a href=//www.colinspear.com/tags title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=//www.colinspear.com>Home</a></div><h1 class=post-title>Similar artist network</h1><div class=post-meta><span title="2023-08-29 00:00:00 +0000 UTC">August 29, 2023</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;Me</div></header><div class=post-content><h2 id=motivation>Motivation<a hidden class=anchor aria-hidden=true href=#motivation>#</a></h2><p>If you are anything like me, you occasionally find yourself coming up for air after a long diversion clicking through artist biographies on Spotify. Often these biographies will list the artists other bands or people they have played with, and one thing leads to another and I have added twenty albums to my &ldquo;new music&rdquo; playlist folder.</p><p>I found myself in this position one morning after listening to <a href=https://casualinfer.libsyn.com/episode-15-dr-betsy-ogburn>this episode</a> of Casual Inference, a great podcast that has unfortunately gone radio silent of late. The guest, <a href=https://twitter.com/BetsyOgburn>Betsy Ogburn</a>, is an expert in causality in social networks, a difficult (so. much. endogeneity.) and super interesting field. I had been reading one of her papers and so my brain was primed for thinking about networks. Could I use the
Spotify API to create an artist network to investigate questions like:</p><ul><li>Does having a more popular artist guest on a track garner more listens?</li><li>Does having a certain producer increase listens?</li><li>Do super studio musicians have any effect on track plays?</li></ul><p>I quickly discovered that this is unfortunately not one of the endpoints in the amazing <a href=https://developer.spotify.com/documentation/web-api/>Spotify API</a> (go check it out if you never have)<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>. After <a href=https://community.spotify.com/t5/Spotify-for-Developers/Include-Biography-in-Artist-s-Metadata-in-Web-API/m-p/5159561#M2086>inquiring</a> about this absence, I realized that the &ldquo;Related artists&rdquo; are a natural way to build an artist network.</p><p>Prior to this I had never done any network analysis with python, so I thought this could be an interesting way to interact with Spotify&rsquo;s API in a new way and learn a little bit about what python tools are available for network analysis. This is my &ldquo;what can I do in an hour&rdquo; exploration of these ideas.</p><h2 id=cleanup>Cleanup<a hidden class=anchor aria-hidden=true href=#cleanup>#</a></h2><blockquote><p>Disclaimer: This post is a quick and dirty analysis! My time was limited, so basically I constrained myself to seeing if I could figure out the relevant tooling and make a plot. I have left it messy so you can see my process getting from nothing to something at least marginally interesting.</p></blockquote><p>I am not including the code to pull the artist information from Spotify. If you are interested, the code for that is on github <a href=https://github.com/colinspear/music-dashboard/blob/main/src/data/artist_networks.py>here</a>. I saved it as json, so the first thing I do here is import the packages I will use in the analysis and massage the data into the shape I need to plot the network. <a href=https://networkx.org/>Networkx</a> seems to be the main python package for network analysis in python. I <em>barely</em> scratch the surface here.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=kn>import</span> <span class=nn>json</span>

<span class=kn>import</span> <span class=nn>networkx</span> <span class=kn>as</span> <span class=nn>nx</span>
<span class=kn>import</span> <span class=nn>pandas</span> <span class=kn>as</span> <span class=nn>pd</span>
<span class=kn>import</span> <span class=nn>numpy</span> <span class=kn>as</span> <span class=nn>np</span>


<span class=c1># load artist data</span>
<span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;../data/raw/followed_artists.json&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
    <span class=n>artists</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>
</code></pre></div><p>Spotify includes a lot of metadata and other information that I am not interested in for this exercise, so the next cell makes a dictionary of only the data that is relevant for my purposes.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=c1># create a dictionary of the relevant information</span>
<span class=n>artists_dict</span> <span class=o>=</span> <span class=p>{}</span>
<span class=n>artists_dict</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=n>i</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>artists</span><span class=p>]</span>
<span class=n>artists_dict</span><span class=p>[</span><span class=s1>&#39;artist&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=n>i</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>artists</span><span class=p>]</span>
<span class=n>artists_dict</span><span class=p>[</span><span class=s1>&#39;followers&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=n>i</span><span class=p>[</span><span class=s1>&#39;followers&#39;</span><span class=p>][</span><span class=s1>&#39;total&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>artists</span><span class=p>]</span>
<span class=n>artists_dict</span><span class=p>[</span><span class=s1>&#39;popularity&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=n>i</span><span class=p>[</span><span class=s1>&#39;popularity&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>artists</span><span class=p>]</span>
<span class=n>artists_dict</span><span class=p>[</span><span class=s1>&#39;related_artist&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=n>i</span><span class=p>[</span><span class=s1>&#39;related_artists&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>artists</span><span class=p>]</span>
</code></pre></div><p>Pandas has a bunch of different methods for reading data into dataframes. <code>.from_dict()</code> will take a dicitonary as input and create a dataframe</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=n>df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=o>.</span><span class=n>from_dict</span><span class=p>(</span><span class=n>artists_dict</span><span class=p>)</span>
</code></pre></div><p>Now we have a dataframe we can use with NetworkX. Unfortunately, the <code>related_artist</code> column is a list. I need to expand it so that each item in the list gets it&rsquo;s own row along with all of the other data in that row. This was a trickier problem that I initially anticipated, but thankfully someone before me had the same problem and a stackoverflow samaritan came to their rescue.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=c1># &#34;melt&#34; name list into individual rows</span>
<span class=c1># https://stackoverflow.com/questions/27263805/pandas-column-of-lists-create-a-row-for-each-list-element</span>

<span class=n>lst_col</span> <span class=o>=</span> <span class=s1>&#39;related_artist&#39;</span>

<span class=n>r</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
      <span class=n>col</span><span class=p>:</span><span class=n>np</span><span class=o>.</span><span class=n>repeat</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=n>col</span><span class=p>]</span><span class=o>.</span><span class=n>values</span><span class=p>,</span> <span class=n>df</span><span class=p>[</span><span class=n>lst_col</span><span class=p>]</span><span class=o>.</span><span class=n>str</span><span class=o>.</span><span class=n>len</span><span class=p>())</span>
      <span class=k>for</span> <span class=n>col</span> <span class=ow>in</span> <span class=n>df</span><span class=o>.</span><span class=n>columns</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span><span class=n>lst_col</span><span class=p>)}</span>
    <span class=p>)</span><span class=o>.</span><span class=n>assign</span><span class=p>(</span><span class=o>**</span><span class=p>{</span><span class=n>lst_col</span><span class=p>:</span><span class=n>np</span><span class=o>.</span><span class=n>concatenate</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=n>lst_col</span><span class=p>]</span><span class=o>.</span><span class=n>values</span><span class=p>)})[</span><span class=n>df</span><span class=o>.</span><span class=n>columns</span><span class=p>]</span>
</code></pre></div><p>Unfortunately, it turns out A$AP Rocky and Joey Bada$$ are too bada$$ for NetworkX.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=n>r</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>r</span><span class=p>[</span><span class=s1>&#39;related_artist&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>str</span><span class=o>.</span><span class=n>contains</span><span class=p>(</span><span class=s1>&#39;\$&#39;</span><span class=p>)]</span>
</code></pre></div><pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre><p></p><p>The $ is a special character and breaks the graphing algorithm. I will make them significantly less cool by replacing their <code>$</code> with <code>S</code>.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=c1># temp fix to remove special characters from name (Joey Bada$$ and A$AP Rocky were throwing errors)</span>
<span class=n>r</span><span class=p>[</span><span class=s1>&#39;artist&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>r</span><span class=p>[</span><span class=s1>&#39;artist&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>str</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;$&#39;</span><span class=p>,</span> <span class=s1>&#39;S&#39;</span><span class=p>)</span>
<span class=n>r</span><span class=p>[</span><span class=s1>&#39;related_artist&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>r</span><span class=p>[</span><span class=s1>&#39;related_artist&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>str</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;$&#39;</span><span class=p>,</span> <span class=s1>&#39;S&#39;</span><span class=p>)</span>
<span class=n>r</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>r</span><span class=p>[</span><span class=s1>&#39;related_artist&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>str</span><span class=o>.</span><span class=n>contains</span><span class=p>(</span><span class=s1>&#39;\$&#39;</span><span class=p>)]</span>
</code></pre></div><pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre><p></p><p>There we go. On to the network graph!</p><h2 id=visualization>Visualization<a hidden class=anchor aria-hidden=true href=#visualization>#</a></h2><p>NetworkX provides a very user friendly out of the box graphing method that will allow you to get a sense of the basic structure of a graph. It is essentially just a wrapper around matplotlib, so you can use matplotlib&rsquo;s extensive (and often arcane) customization if you need to make something pretty to show your bosses. For my current purposes, I just want to get a sense of the network structure, then go on to look at some of the statistical features of the network. Here goes.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=n>G</span> <span class=o>=</span> <span class=n>nx</span><span class=o>.</span><span class=n>from_pandas_edgelist</span><span class=p>(</span><span class=n>r</span><span class=p>,</span> 
                            <span class=n>source</span><span class=o>=</span><span class=s1>&#39;artist&#39;</span><span class=p>,</span>
                            <span class=n>target</span><span class=o>=</span><span class=s1>&#39;related_artist&#39;</span><span class=p>,</span>
                            <span class=n>edge_attr</span><span class=o>=</span><span class=s1>&#39;followers&#39;</span><span class=p>,</span>
                            <span class=n>create_using</span><span class=o>=</span><span class=n>nx</span><span class=o>.</span><span class=n>DiGraph</span><span class=p>())</span>
</code></pre></div><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=n>nx</span><span class=o>.</span><span class=n>draw_networkx</span><span class=p>(</span><span class=n>G</span><span class=p>)</span>
</code></pre></div><p><img loading=lazy src=/images/artist_graph/artist_graph_9_1.png alt=png></p><p>Oof, that&rsquo;s not very helpful. It looks like it could be a bit donut shaped? Let&rsquo;s pare things down a bit. I&rsquo;m just going to take a random sample and replot to see if that helps.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=n>r_graph</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>sample</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>
<span class=n>G</span> <span class=o>=</span> <span class=n>nx</span><span class=o>.</span><span class=n>from_pandas_edgelist</span><span class=p>(</span><span class=n>r_graph</span><span class=p>,</span> 
                            <span class=n>source</span><span class=o>=</span><span class=s1>&#39;artist&#39;</span><span class=p>,</span>
                            <span class=n>target</span><span class=o>=</span><span class=s1>&#39;related_artist&#39;</span><span class=p>,</span>
                            <span class=n>edge_attr</span><span class=o>=</span><span class=s1>&#39;followers&#39;</span><span class=p>,</span>
                            <span class=n>create_using</span><span class=o>=</span><span class=n>nx</span><span class=o>.</span><span class=n>DiGraph</span><span class=p>())</span>

<span class=n>nx</span><span class=o>.</span><span class=n>draw_networkx</span><span class=p>(</span><span class=n>G</span><span class=p>)</span>
</code></pre></div><p><img loading=lazy src=/images/artist_graph/artist_graph_11_0.png alt=png></p><p>There&rsquo;s our donut! It&rsquo;s definitely a small world graph with a few artists in the middle, connecting the disparate groups (makes sense that Arthur Russell and Bonnie Prince Billy would be the weirdos crossing over :).</p><p>Let&rsquo;s get rid of the names, make the nodes smaller and increase the sample size a bit.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=n>r_graph</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>sample</span><span class=p>(</span><span class=mi>500</span><span class=p>)</span>
<span class=n>G</span> <span class=o>=</span> <span class=n>nx</span><span class=o>.</span><span class=n>from_pandas_edgelist</span><span class=p>(</span><span class=n>r_graph</span><span class=p>,</span> 
                            <span class=n>source</span><span class=o>=</span><span class=s1>&#39;artist&#39;</span><span class=p>,</span>
                            <span class=n>target</span><span class=o>=</span><span class=s1>&#39;related_artist&#39;</span><span class=p>,</span>
                            <span class=n>edge_attr</span><span class=o>=</span><span class=s1>&#39;followers&#39;</span><span class=p>,</span>
                            <span class=n>create_using</span><span class=o>=</span><span class=n>nx</span><span class=o>.</span><span class=n>DiGraph</span><span class=p>())</span>

<span class=n>nx</span><span class=o>.</span><span class=n>draw_networkx</span><span class=p>(</span><span class=n>G</span><span class=p>,</span> <span class=n>with_labels</span><span class=o>=</span><span class=bp>False</span><span class=p>,</span> <span class=n>node_size</span><span class=o>=</span><span class=mi>10</span><span class=p>)</span>
</code></pre></div><p><img loading=lazy src=/images/artist_graph/artist_graph_14_0.png alt=png></p><p>Much better. Just lighten up the edges a touch and&mldr;</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=n>nx</span><span class=o>.</span><span class=n>draw_networkx</span><span class=p>(</span><span class=n>G</span><span class=p>,</span> <span class=n>with_labels</span><span class=o>=</span><span class=bp>False</span><span class=p>,</span> <span class=n>node_size</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span> <span class=n>width</span><span class=o>=</span><span class=mf>0.5</span><span class=p>)</span>
</code></pre></div><p><img loading=lazy src=/images/artist_graph/artist_graph_15_0.png alt=png></p><p>Voila!</p><h2 id=is-this-a-small-world-network>Is this a Small World Network?<a hidden class=anchor aria-hidden=true href=#is-this-a-small-world-network>#</a></h2><p>Visually, this looks like it could be a <a href=https://en.wikipedia.org/wiki/Small-world_network>Small-world network</a>, with a sort of halo of clusters around the edgo of the graph and a non-trivial number of paths from opposing edges. From the Wikipedia article:</p><blockquote><p>A small-world network is a type of mathematical graph in which most nodes are not neighbors of one another, but the neighbors of any given node are likely to be neighbors of each other and most nodes can be reached from every other node by a small number of hops or steps.</p></blockquote><p>To wrap up this blog post, I am going to calculate some statistics to see if this indeed is likely a Small-world network and have a look at the artists that most connect otherwise disparate parts of the graph.</p><p>One of the signature characteristics of this type of network is that the distance between randomly chosen nodes (in this case artists) is proportional to the logarithm of the total number of nodes in the network<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>.</p><p>According to <a href=https://stats.stackexchange.com/questions/175492/how-to-test-statistically-whether-my-network-graph-is-a-small-world-network>this post</a>, the best way to do this is to calculate the mean shortest path length and clustering coefficients of your network and compare them to the equivalent statistics of a synthetic random network. So this is what we will do. But before we do that, let&rsquo;s talk about what exactly those things are.</p><blockquote><h3 id=diversion-on-path-length-and-clustering>Diversion on path length and clustering<a hidden class=anchor aria-hidden=true href=#diversion-on-path-length-and-clustering>#</a></h3><p>TODO: briefly explain clustering and path length</p></blockquote><p>Now, back to our analysis. Our procedure is the following:</p><ol><li>Calculate average path length and clustering coefficient of the original network.</li><li>Generate the appropriate synthetic network.</li><li>Repeat Step 1 for the synthetic network.</li><li>Calculate small-world statistics.</li><li>Prosper.</li></ol><h2 id=why-do-we-care-about-whether-or-not-this-is-a-small-world-network>Why do we care about whether or not this is a small world network?<a hidden class=anchor aria-hidden=true href=#why-do-we-care-about-whether-or-not-this-is-a-small-world-network>#</a></h2><p>The network we are examining is all of the related artists of the artists I follow on Spotify. What is this, exactly? According to the <a href=https://developer.spotify.com/documentation/web-api/reference/#endpoint-get-an-artists-related-artists>Spotify API docs</a>, related artists are <em>artists similar to a given artist</em> and <em>similarity is based on analysis of the Spotify community’s listening history</em>. <a href=https://artists.spotify.com/blog/how-fans-also-like-works>This article</a> goes into a bit more detail, hinting that size of listenership and number of shared listeners are important parameters in the algorithm that decides shared listeners, but few details are provided. This means that at a high, hand-wavy level, the related artists I see for <a href="https://open.spotify.com/artist/4gHcu2JoaXJ0mV4aNPCd7N?si=ZXWDHr2pQsGwdVPpamvtrg&dl_branch=1">Benny Sings</a> are just other artists whose listeners overlap in some significant way with Benny Sings&rsquo; listeners.</p><p>So what we have here is a listening network.</p><p>Questions:</p><ul><li>Who is connected to the most other artists?</li><li>Who connects otherwise poorly connected regions?</li><li>Do we have any natural clusters or communities? What do they have in common?</li></ul><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>After doing some poking around, I noticed that they get most of their biographical information from <a href=http://prod-doc.rovicorp.com/mashery/index.php/Data/APIs/Rovi-Music>Rovi</a>, which also has <strong>a lot</strong> of other information. I can&rsquo;t tell what their usage model it, but I would love to poke into it more at some point. <a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2 role=doc-endnote><p>At first I thought I could do this by randomly sampling nodes from my artist network, but it&rsquo;s not actually that simple. One interesting exercise that might get at this would be to choose an artist and build the connected graph step by step (i.e. record the original artist&rsquo;s network, then include their network&rsquo;s netowrks, and so on until you run out of artists or patience), calculating the distance between randomly chosen nodes and the log total nodes at each step. I think this would reasonably approximate the natural growth of a listening network and would certainly be better that just sampling nodes. <a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=next href=//www.colinspear.com/technical-posts/python-visualization-sucks/><span class=title>Next »</span><br><span>Python sucks at basic data visualization</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=//www.colinspear.com>Colin Spear</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z" /></svg></a><script>let menu=document.getElementById('menu')
if(menu){menu.scrollLeft=localStorage.getItem("menu-scroll-position");menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft);}}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);if(!window.matchMedia('(prefers-reduced-motion: reduce)').matches){document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});}else{document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();}
if(id==="top"){history.replaceState(null,null," ");}else{history.pushState(null,null,`#${id}`);}});});</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script><script>document.querySelectorAll('pre > code').forEach((codeblock)=>{const container=codeblock.parentNode.parentNode;const copybutton=document.createElement('button');copybutton.classList.add('copy-code');copybutton.innerHTML='copy';function copyingDone(){copybutton.innerHTML='copied!';setTimeout(()=>{copybutton.innerHTML='copy';},2000);}
copybutton.addEventListener('click',(cb)=>{if('clipboard'in navigator){navigator.clipboard.writeText(codeblock.textContent);copyingDone();return;}
const range=document.createRange();range.selectNodeContents(codeblock);const selection=window.getSelection();selection.removeAllRanges();selection.addRange(range);try{document.execCommand('copy');copyingDone();}catch(e){};selection.removeRange(range);});if(container.classList.contains("highlight")){container.appendChild(copybutton);}else if(container.parentNode.firstChild==container){}else if(codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"){codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);}else{codeblock.parentNode.appendChild(copybutton);}});</script></body></html>