<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Count files by type and directory | Colin Spear</title>
<meta name=keywords content="command-line,bash,grep,awk">
<meta name=description content="Using the command line to count stuff">
<meta name=author content="Colin">
<link rel=canonical href=//www.colinspear.com/technical-posts/count-files-by-type-and-directory/>
<meta name=google-site-verification content="XYZabc">
<meta name=yandex-verification content="XYZabc">
<meta name=msvalidate.01 content="XYZabc">
<link crossorigin=anonymous href=/assets/css/stylesheet.min.ec8da366ca2fb647537ccb7a8f6fa5b4e9cd3c7a0d3171dd2d3baad1e49c8bfc.css integrity="sha256-7I2jZsovtkdTfMt6j2+ltOnNPHoNMXHdLTuq0eSci/w=" rel="preload stylesheet" as=style>
<link rel=preload href=/logo-fill.png as=image>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=//www.colinspear.com/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=//www.colinspear.com/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=//www.colinspear.com/favicon-32x32.png>
<link rel=apple-touch-icon href=//www.colinspear.com/apple-touch-icon.png>
<link rel=mask-icon href=//www.colinspear.com/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.92.0">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BFJ2WK0V8F"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-BFJ2WK0V8F',{anonymize_ip:!1})}</script>
<meta property="og:title" content="Count files by type and directory">
<meta property="og:description" content="Using the command line to count stuff">
<meta property="og:type" content="article">
<meta property="og:url" content="//www.colinspear.com/technical-posts/count-files-by-type-and-directory/"><meta property="article:section" content="technical-posts">
<meta property="article:published_time" content="2020-12-17T00:00:00+00:00">
<meta property="article:modified_time" content="2020-12-17T00:00:00+00:00"><meta property="og:site_name" content="Colin Spear">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Count files by type and directory">
<meta name=twitter:description content="Using the command line to count stuff">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Technical-posts","item":"//www.colinspear.com/technical-posts/"},{"@type":"ListItem","position":3,"name":"Count files by type and directory","item":"//www.colinspear.com/technical-posts/count-files-by-type-and-directory/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Count files by type and directory","name":"Count files by type and directory","description":"Using the command line to count stuff","keywords":["command-line","bash","grep","awk"],"articleBody":"I have been working on updating a 15 year old data collection / ETL process in the last weeks. As part of the planning process, I wanted to know how many people are using the data we collect1. Sure, I could ask people, but how does that help me sharpen my skills a Data Wizard2.\nAt my work, our shared server is organized by analyst (i.e. each of the subfolders to the team’s main directory is the name of an employee). Since our data is stored in a SQL database and you need to write a query to get the data, I can get a quick and dirty look at who is using this data and how often. I can simply look in everybody’s folder for .sql files that contain a distinct word or phrase that will identify my database.\nTo do this efficiently at the command line, I used a couple of built in bash functions (awk, sort and uniq) and the speedy version of another: ripgrep (grep). They aren’t exactly faster versions as they don’t mimic the behavior of the built-ins, but they accomplish many of the same tasks. Most importantly for me, it means I can do this task without having to wait around for a day for my code to run.\nThe basic procedure is the following:\n Search through each directory for .sql files. Check whether those files contain the pattern I am looking for. If so, add the file path to my list. (optional) Save the list to a file. Split the file paths to get just the names of people who have used the data and saved their query. Sort and count the number of files.  I’m going to do this in two lines which could be chained together using xargs (also left to the reader) or made into a function. I may consider the latter if it turns out to be something useful down the line as well. The first command I used makes a list of all the files I am interested in and save it as the text file MyQueries.txt:\nrg 'dbo.CoolTable' -g '!BadDirectory/*' -g '*.sql' -l -i  /Path/to/MyQueries.txt Here’s what each part of that command does:\n rg 'dbo.CoolTable': uses ripgrep to search for dbo.CoolTable. The pattern you give is a regular expression (unless you speccify otherwise with the -F or --fixed-strings flag), so you can as fancy as you want with your regex. -g '!BadDirectory/*': this is the glob command which allows you to tell ripgrep what directories to look in or avoid in its search. The ! in front of the directory name tells ripgrep to exclude that directory. Glob flags can be used more than once (which brings us to our next piece): -g '*.sql': another glob flag to search only for SQL files. This can also be specified with the --type (-t) flag and the file type you are interested in (sql in my case). I went this route because the latter flag wasn’t working for me. -l -i: -l (--files-with-matches) returns the file path where at least one match was found and -i (--ignore-case) makes your pattern search case insensitive. Since SQL is case-insensitive, using this means I’ll get files where people use dbo.cooltable, DBO.COOLTABLE and everything in between.  /Path/to/MyQueries.txt: finally I redirect the output from ripgrep to the textfile which I will analyze with my next command.  The second command takes the list of files I found, parses it for my colleagues' names and counts how many files there are in each of their directories:\nawk -F \"/\" '{print $1}' /Path/to/MyQueries.txt | sort | uniq -c  query-count.txt Awk is actually its very own programming language (!) that is mostly used for extracting data from text. There is a whole lot to it, so if you are interested, go spend the day on the documentation. All I’m going to do for you here is explain my little command :). Again, bit by bit:\n awk -F \"/\": calls awk and specifies a delimiter to use to parse your data. Since I am dealing with file paths, I use the forward (or is it backward?) slash. '{print $1}' tells awk to return the first element of my parsed line. Since the file paths I have in my file go something like NameOfColleague/subdir/*/sql_file.sql with the name of my coworker always in the first position, this gives me one instance of each person’s name for each query they have written to my database. /Path/to/MyQueries.txt: tells awk what file to operate on. | sort | uniq -c: finally, the resulting list of names is sorted and counted! What I really want only the number of times each name appears in my list, so you would think sort wouldn’t be necessary. However, uniq only detects repeats in adjacent lines, so the list has to be sorted with the sort command before passing it to uniq. -c tells uniq to return a count of unique occurences it finds.  And there you have it! A long explanation of a short series of commands that will give you the number of files that contain a text snippet of interest, grouped by directory.\n  I also want to know which features folks are using which I may also try to do at the command line, but that exercise is currently left to the reader. ↩︎\n I am just kidding here in case you were wondering. Usually talking to people gets us to the answer to a question like this much more quickly and effectively than any silly computer wizardry. ↩︎\n   ","wordCount":"924","inLanguage":"en","datePublished":"2020-12-17T00:00:00Z","dateModified":"2020-12-17T00:00:00Z","author":{"@type":"Person","name":"Colin"},"mainEntityOfPage":{"@type":"WebPage","@id":"//www.colinspear.com/technical-posts/count-files-by-type-and-directory/"},"publisher":{"@type":"Organization","name":"Colin Spear","logo":{"@type":"ImageObject","url":"//www.colinspear.com/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=//www.colinspear.com accesskey=h title="Colin Spear (Alt + H)">
<img src=//www.colinspear.com/logo-fill.png alt=logo aria-label=logo height=35>Colin Spear</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=//www.colinspear.com/links/ title=Links>
<span>Links</span>
</a>
</li>
<li>
<a href=//www.colinspear.com/thoughts-posts/ title=Notes>
<span>Notes</span>
</a>
</li>
<li>
<a href=//www.colinspear.com/technical-posts/ title=Technical>
<span>Technical</span>
</a>
</li>
<li>
<a href=//www.colinspear.com/books/ title=Books>
<span>Books</span>
</a>
</li>
<li>
<a href=//www.colinspear.com/tags title=Tags>
<span>Tags</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=//www.colinspear.com>Home</a>&nbsp;»&nbsp;<a href=//www.colinspear.com/technical-posts/>Technical-posts</a></div>
<h1 class=post-title>
Count files by type and directory
</h1>
<div class=post-meta><span title="2020-12-17 00:00:00 +0000 UTC">December 17, 2020</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;Colin
</div>
</header>
<div class=post-content><p>I have been working on updating a 15 year old data collection / ETL process in the last weeks. As part of the planning process, I wanted to know how many people are using the data we collect<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>. Sure, I could <em>ask</em> people, but how does that help me sharpen my skills a Data Wizard<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>.</p>
<p>At my work, our shared server is organized by analyst (i.e. each of the subfolders to the team&rsquo;s main directory is the name of an employee). Since our data is stored in a SQL database and you need to write a query to get the data, I can get a quick and dirty look at who is using this data and how often. I can simply look in everybody&rsquo;s folder for <code>.sql</code> files that contain a distinct word or phrase that will identify my database.</p>
<p>To do this efficiently at the command line, I used a couple of built in bash functions (<code>awk</code>, <code>sort</code> and <code>uniq</code>) and the speedy version of another: <code>ripgrep</code> (<code>grep</code>). They aren&rsquo;t exactly faster versions as they don&rsquo;t mimic the behavior of the built-ins, but they accomplish many of the same tasks. Most importantly for me, it means I can do this task without having to wait around for a day for my code to run.</p>
<p>The basic procedure is the following:</p>
<ol>
<li>Search through each directory for <code>.sql</code> files.</li>
<li>Check whether those files contain the pattern I am looking for.</li>
<li>If so, add the file path to my list.</li>
<li>(optional) Save the list to a file.</li>
<li>Split the file paths to get just the names of people who have used the data and saved their query.</li>
<li>Sort and count the number of files.</li>
</ol>
<p>I&rsquo;m going to do this in two lines which could be chained together using <code>xargs</code> (also left to the reader) or made into a function. I may consider the latter if it turns out to be something useful down the line as well. The first command I used makes a list of all the files I am interested in and save it as the text file <code>MyQueries.txt</code>:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>rg &#39;dbo.CoolTable&#39; -g &#39;!BadDirectory/*&#39; -g &#39;*.sql&#39; -l -i &gt; /Path/to/MyQueries.txt
</code></pre></div><p>Here&rsquo;s what each part of that command does:</p>
<ul>
<li><code>rg 'dbo.CoolTable'</code>: uses ripgrep to search for <code>dbo.CoolTable</code>. The pattern you give is a regular expression (unless you speccify otherwise with the <code>-F</code> or <code>--fixed-strings</code> flag), so you can as fancy as you want with your regex.</li>
<li><code>-g '!BadDirectory/*'</code>: this is the glob command which allows you to tell ripgrep what directories to look in or avoid in its search. The <code>!</code> in front of the directory name tells ripgrep to exclude that directory. Glob flags can be used more than once (which brings us to our next piece):</li>
<li><code>-g '*.sql'</code>: another glob flag to search only for SQL files. This can also be specified with the <code>--type</code> (<code>-t</code>) flag and the file type you are interested in (<code>sql</code> in my case). I went this route because the latter flag wasn&rsquo;t working for me.</li>
<li><code>-l -i</code>: <code>-l</code> (<code>--files-with-matches</code>) returns the file path where at least one match was found and <code>-i</code> (<code>--ignore-case</code>) makes your pattern search case insensitive. Since SQL is case-insensitive, using this means I&rsquo;ll get files where people use <code>dbo.cooltable</code>, <code>DBO.COOLTABLE</code> and everything in between.</li>
<li><code>> /Path/to/MyQueries.txt</code>: finally I redirect the output from ripgrep to the textfile which I will analyze with my next command.</li>
</ul>
<p>The second command takes the list of files I found, parses it for my colleagues' names and counts how many files there are in each of their directories:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>awk -F &#34;/&#34; &#39;{print $1}&#39; /Path/to/MyQueries.txt | sort | uniq -c &gt; query-count.txt
</code></pre></div><p>Awk is actually its <a href=https://en.wikipedia.org/wiki/AWK>very own programming language</a> (!) that is mostly used for extracting data from text. There is a whole lot to it, so if you are interested, go spend the day <a href=https://www.gnu.org/software/gawk/manual/gawk.html>on the documentation</a>. All I&rsquo;m going to do for you here is explain my little command :). Again, bit by bit:</p>
<ul>
<li><code>awk -F "/"</code>: calls awk and specifies a delimiter to use to parse your data. Since I am dealing with file paths, I use the forward (or is it backward?) slash.</li>
<li><code>'{print $1}'</code> tells awk to return the first element of my parsed line. Since the file paths I have in my file go something like <code>NameOfColleague/subdir/*/sql_file.sql</code> with the name of my coworker always in the first position, this gives me one instance of each person&rsquo;s name for each query they have written to my database.</li>
<li><code>/Path/to/MyQueries.txt</code>: tells <code>awk</code> what file to operate on.</li>
<li><code>| sort | uniq -c</code>: finally, the resulting list of names is sorted and counted! What I really want only the number of times each name appears in my list, so you would think <code>sort</code> wouldn&rsquo;t be necessary. However, <code>uniq</code> only detects repeats in <em>adjacent</em> lines, so the list has to be sorted with the <code>sort</code> command before passing it to <code>uniq</code>. <code>-c</code> tells <code>uniq</code> to return a count of unique occurences it finds.</li>
</ul>
<p>And there you have it! A long explanation of a short series of commands that will give you the number of files that contain a text snippet of interest, grouped by directory.</p>
<section class=footnotes role=doc-endnotes>
<hr>
<ol>
<li id=fn:1 role=doc-endnote>
<p>I also want to know which features folks are using which I may also try to do at the command line, but <a href=https://www.reddit.com/r/physicsmemes/comments/8wil0z/the_meme_is_left_as_an_exercise_for_the_reader/>that exercise is currently left to the reader</a>.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p>
</li>
<li id=fn:2 role=doc-endnote>
<p>I am just kidding here in case you were wondering. Usually talking to people gets us to the answer to a question like this much more quickly and effectively than any silly computer wizardry.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p>
</li>
</ol>
</section>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=//www.colinspear.com/tags/command-line/>command-line</a></li>
<li><a href=//www.colinspear.com/tags/bash/>bash</a></li>
<li><a href=//www.colinspear.com/tags/grep/>grep</a></li>
<li><a href=//www.colinspear.com/tags/awk/>awk</a></li>
</ul>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2022 <a href=//www.colinspear.com>Colin Spear</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>